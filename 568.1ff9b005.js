(self.webpackChunknmemonica=self.webpackChunknmemonica||[]).push([["568"],{2342:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n("10327"),a=n("58093"),s=n("22707"),i=n("78615"),o=n("83169"),l=n("40432"),c=n("37654"),u=n("28733"),d=n("80130"),h=n("43398"),v=n("22839"),f=n("9871"),m=n("16332"),p=n("34616"),b=n("38354"),S=n("72530"),x=n("87177"),w=n("84193"),g=n("93781");function j(){let e=(0,l.useDispatch)(),{localServiceURL:t,lastImport:n}=(0,l.useSelector)(({global:e})=>e),[j,y]=(0,o.useState)(!1),[k,E]=(0,o.useState)(!1),[D,N]=(0,o.useState)(!1),L=(0,o.useCallback)(()=>{if(!confirm("User edited datasets will be overwritten"))return;let n=(0,u.getExternalSourceType)(t);n===u.ExternalSourceType.Unset?e((0,f.setLocalDataEdited)(!1)):e((0,f.setLocalDataEdited)(!0)),e((0,x.importDatasets)()).unwrap().then(t=>Promise.all(t.map(t=>{let{data:n,hash:r}=(0,s.sheetDataToJSON)(t),a=t.name.toLowerCase();return e((0,w.setVersion)({name:a,hash:r})),(0,v.swMessageSaveDataJSON)(d.dataServiceEndpoint+"/"+a+".json.v"+r,n,r).then(()=>t)})).then(t=>((0,h.openIDB)().then(e=>(0,h.putIDBItem)({db:e,store:h.IDBStores.WORKBOOK},{key:"0",workbook:t})),e((0,w.setSwVersions)())))).then(()=>{e((0,g.clearVocabulary)()),e((0,S.clearPhrases)()),e((0,m.clearKanji)()),e((0,b.clearParticleGame)()),e((0,p.clearOpposites)()),N(!0),e((0,f.setLastImport)(`${["Reset","Local","GitHub"][n]}: ${new Date().toJSON()}`))})},[e,t]),P=(0,o.useCallback)(e=>{y(e)},[]),T=(0,o.useCallback)(e=>{E(e),!e&&N(null)},[]);return(0,r.jsx)("div",{className:"outer",children:(0,r.jsxs)("div",{className:"d-flex flex-column flex-sm-row justify-content-between",children:[(0,r.jsx)("div",{className:"column-1 mb-2 me-sm-2",children:(0,r.jsx)("div",{className:"mt-2 mb-2",children:[(0,r.jsx)("div",{children:"Recent import history:"},"label"),...n.map(e=>(0,r.jsx)("div",{className:"pt-1",children:e},e))]})}),(0,r.jsxs)("div",{className:"column-2",children:[(0,r.jsx)("div",{className:"mb-2",children:(0,r.jsx)(u.default,{onChangeInput:P,onChangeTrust:T})}),(0,r.jsxs)("div",{className:"d-flex",children:[(0,r.jsx)("div",{className:"px-1",children:(0,r.jsxs)(a.Button,{"aria-label":"Import Datasets",variant:"outlined",size:"small",disabled:j||""===t||!0!==k||!0===D,onClick:L,children:[D?(0,r.jsx)(i.CheckCircleIcon,{size:"small",className:"pe-1"}):(0,r.jsx)(i.DownloadIcon,{size:"small",className:"pe-1"}),"Import"]})}),(0,r.jsx)("div",{className:"px-1",children:(0,r.jsx)(a.Button,{"aria-label":"Edit Datasets",variant:"contained",size:"small",disabled:j||""===t||!k,children:(0,r.jsxs)(c.Link,{to:"/sheet",className:"text-decoration-none",children:["Edit ",(0,r.jsx)(i.UndoIcon,{})]})})})]})]})]})})}},285:function(e,t,n){"use strict";n.r(t),n.d(t,{getActiveSheet:function(){return a},removeLastRowIfBlank:function(){return s},addExtraRow:function(){return i},searchInSheet:function(){return o},touchScreenCheck:function(){return l}});var r=n("88134");function a(e){let t=e.getData(),n=e.bottombar.activeEl.el.innerHTML,r=t.find(e=>e.name===n)??t[0],a=s(r);return{activeSheetName:n,activeSheetData:a}}function s(e){let t=e.rows;if(!e.rows||!t)return e;let n={...e,rows:t},a=(0,r.getLastCellIdx)(e.rows);return Object.values(e.rows[a].cells).every(e=>void 0===e.text||0===e.text.length||""===e.text.trim())&&(delete n.rows[a],n.rows.len-=1),n}function i(e){let t=e.reduce((e,t)=>{let n=t.rows;if(!n)return[...e,{rows:{0:{cells:{}}},len:1}];let a=(0,r.getLastCellIdx)(n),s={...t,rows:{...n,[String(a+1)]:{cells:{}},len:n.len+1}};return[...e,s]},[]);return t}function o(e,t){if(!e.rows)return[];let n=Object.values(e.rows).reduce((e,n,r)=>{if("number"!=typeof n&&"cells"in n){let a=Object.keys(n.cells).find(e=>n.cells[Number(e)].text?.toLowerCase().includes(t.toLowerCase()));if(void 0===a)return e;let s=n.cells[Number(a)].text;if(void 0===s)return e;let i=Number(a);e=[...e,[r,i,s]]}return e},[]);return n}function l(){let e=!1;if("maxTouchPoints"in navigator&&"number"==typeof navigator.maxTouchPoints)e=navigator.maxTouchPoints>0;else if("msMaxTouchPoints"in navigator&&"number"==typeof navigator.msMaxTouchPoints)e=navigator.msMaxTouchPoints>0;else{let t=matchMedia?.("(pointer:coarse)");if(t?.media==="(pointer:coarse)")e=!!t.matches;else if("orientation"in window)e=!0;else{let t=navigator.userAgent;e=/\b(BlackBerry|webOS|iPhone|IEMobile)\b/i.test(t)||/\b(Android|Windows Phone|iPad|iPod)\b/i.test(t)}}return e}},87177:function(e,t,n){"use strict";n.r(t),n.d(t,{importDatasets:function(){return b},getDatasets:function(){return x},saveSheetLocalService:function(){return w},saveSheetServiceWorker:function(){return g}});var r=n("89780"),a=n("22707"),s=n("88134"),i=n("71387"),o=n("9871"),l=n("16332"),c=n("72530");n("40665");var u=n("93781"),d=n("80130"),h=n("28733"),v=n("22839"),f=n("285");class m extends EventTarget{line(e){this.dispatchEvent(new CustomEvent("line",{detail:e}))}close(e){this.dispatchEvent(new CustomEvent("close",{detail:e}))}on(e,t){let n=e=>{if("detail"in e&&"string"==typeof e.detail){let{detail:n}=e;return t(n)}return t("")};switch(e){case"line":this.addEventListener("line",n);break;case"close":this.addEventListener("close",n)}}}function p(e,t){let n=t.slice(0,t.indexOf("."));return fetch(e+t).then(e=>{if(!e.ok)throw Error("bad response?");return e.text()}).then(e=>{let t=new m;t.addEventListener("line",()=>{});let a=(0,r.csvToObject)(t,n),s=e.includes("\r\n")?"\r\n":"\n";return e.split(s).forEach(e=>{t.line(e)}),t.close(),a})}let b=(0,i.createAsyncThunk)("sheet/importDatasets",async(e,t)=>{let n;let r=t.getState(),{localServiceURL:a}=r.global,s=(0,h.getExternalSourceType)(r.global.localServiceURL),i=r.global.localServiceURL;switch(s){case h.ExternalSourceType.GitHubUserContent:n=Promise.all([p(i+"/","Phrases.csv"),p(i+"/","Vocabulary.csv"),p(i+"/","Kanji.csv")]);break;case h.ExternalSourceType.LocalService:n=fetch(i+d.sheetServicePath,(0,o.requiredAuth)(a)).then(e=>e.json()).then(e=>e);break;default:n=S(t.dispatch)}return n});function S(e){let t=e((0,u.getVocabulary)()).unwrap(),n=e((0,c.getPhrase)()).unwrap(),r=e((0,l.getKanji)()).unwrap(),s=["Phrases","Vocabulary","Kanji"];return Promise.all([n,t,r]).then(e=>e.reduce((e,{value:t},n)=>[...e,(0,a.jtox)(t,s[n])],[]))}let x=(0,i.createAsyncThunk)("sheet/getDatasets",async(e,t)=>S(t.dispatch));function w(e,t){if(!e)return Promise.reject(Error("Missing workbook"));let{activeSheetData:n,activeSheetName:r}=(0,f.getActiveSheet)(e),a=new FormData,s=new Blob([JSON.stringify(n)],{type:"application/json"});return a.append("sheetType","xSheetObj"),a.append("sheetName",r),a.append("sheetData",s),fetch(t+d.sheetServicePath,{method:"PUT",credentials:"include",body:a}).then(e=>{if(!e.ok)throw Error("Faild to save sheet");return e.json().then(({hash:e})=>({hash:e,name:r}))})}function g(e){if(!e)return Promise.reject(Error("Missing workbook"));let{activeSheetData:t,activeSheetName:n}=(0,f.getActiveSheet)(e);if(!(0,s.isFilledSheetData)(t))throw Error("Missing data");let r=(0,f.removeLastRowIfBlank)(t),{data:i,hash:o}=(0,a.sheetDataToJSON)(r),l=t.name.toLowerCase();return(0,v.swMessageSaveDataJSON)(d.dataServiceEndpoint+"/"+l+".json.v"+o,i,o).then(()=>({name:n,hash:o}))}let j=(0,i.createSlice)({name:"sheet",initialState:{},reducers:{}}),{}=j.actions;j.reducer},84193:function(e,t,n){"use strict";n.r(t),n.d(t,{getVersions:function(){return o},setSwVersions:function(){return l},setVersion:function(){return d},default:function(){return h}});var r=n("71387"),a=n("9871"),s=n("80130"),i=n("22839");let o=(0,r.createAsyncThunk)("version/getVersions",async(e,t)=>{let n=t.getState(),{localServiceURL:r}=n.global;return fetch(s.dataServiceEndpoint+"/cache.json",(0,a.requiredAuth)(r)).then(e=>e.json())}),l=(0,r.createAsyncThunk)("version/setSwVersions",async(e,t)=>{let n=t.getState(),r={...n.version},a=s.dataServiceEndpoint+"/cache.json";return(0,i.swMessageSaveDataJSON)(a,r,"")}),c=(0,r.createSlice)({name:"version",initialState:{vocabulary:void 0,phrases:void 0,kanji:void 0,opposites:void 0,particles:void 0,suffixes:void 0},reducers:{clearVersions(e){e.vocabulary=void 0,e.phrases=void 0,e.kanji=void 0,e.opposites=void 0,e.particles=void 0,e.suffixes=void 0},setVersion(e,t){let{name:n,hash:r}=t.payload;e[n]=r}},extraReducers:e=>{e.addCase(o.fulfilled,(e,t)=>{let{vocabulary:n,kanji:r,phrases:a,opposites:s,particles:i,suffixes:o}=t.payload;e.kanji=r,e.vocabulary=n,e.phrases=a,e.opposites=s,e.particles=i,e.suffixes=o})}}),{clearVersions:u,setVersion:d}=c.actions;var h=c.reducer}}]);