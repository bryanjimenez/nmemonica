(()=>{"use strict";var e={},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var c=t[r]={exports:{}};return e[r](c,c.exports,n),c.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.rv=()=>"1.2.8",n.ruid="bundler=rspack@1.2.8";var r={};n.r(r),n.d(r,{p:()=>d});let o=Object.freeze({CACHE_RELOAD:{"Cache-Control":"reload"},CACHE_NO_WRITE:{"Cache-Control":"no-store"},DATA_VERSION:"Data-Version"});Object.freeze({UI_LOGGER_MSG:"ui_logger_msg"});let c=Object.freeze({POST_INSTALL_ACTIVATE_DONE:"POST_INSTALL_ACTIVATE_DONE",SERVICE_WORKER_LOGGER_MSG:"service_worker_logger_msg",SERVICE_WORKER_NEW_TERMS_ADDED:"service_worker_new_terms"}),i=Object.freeze({SW_GET_VERSIONS:"SW_GET_VERSIONS",SW_REFRESH_HARD:"SW_REFRESH_HARD",DATASET_JSON_SAVE:"DATASET_JSON_SAVE"}),s=(Error("Service Worker not available"),Object.freeze({MEDIA:"media",STATE:"state",SETTINGS:"settings",WORKBOOK:"workbook"})),a=Object.freeze({NoResult:"IDBNoResults"});function l(){let{version:e,logger:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=indexedDB.open("nmemonica-db",e??1),r=new Promise(e=>{n.onupgradeneeded=function(t){if(null===t.target)throw Error("onupgradeneeded failed");let n=t.target.result;if(0===t.oldVersion){let t=n.createObjectStore(s.MEDIA,{keyPath:"uid"}),r=new Promise((e,n)=>{t.transaction.oncomplete=function(){e()}}),o=n.createObjectStore(s.STATE,{keyPath:"key"}),c=new Promise((e,t)=>{o.transaction.oncomplete=function(){e()}}),i=n.createObjectStore(s.SETTINGS,{keyPath:"key"}),a=new Promise((e,t)=>{i.transaction.oncomplete=function(){e()}}),l=n.createObjectStore(s.WORKBOOK,{keyPath:"key"});Promise.all([r,c,a,new Promise((e,t)=>{l.transaction.oncomplete=function(){e()}})]).then(()=>{e({type:"upgrade",val:n})})}}}),o=new Promise((e,r)=>{n.onerror=function(){"function"==typeof t&&t("IDB.open X(",1),r()},n.onsuccess=function(n){if(null===n.target)throw Error("openIDB failed");let r=n.target.result;r.onerror=function(e){if(e.target&&"errorCode"in e.target){let{errorCode:n}=e.target;"function"==typeof t&&t("IDB Open X(",1)}},e({type:"open",val:r})}});return Promise.any([r,o]).then(e=>"upgrade"===e.type?o.then(e=>e.val):e.val)}Object.freeze({State:{EDITED:"localDataEdited"}});let u=Object.freeze({OFF:0,ERROR:1,WARN:2,DEBUG:3});Object.freeze({GROUP:0,FREQUENCY:1,TAGS:2}),Object.freeze({RANDOM:0,ALPHABETIC:1,DIFFICULTY:2,VIEW_DATE:3,RECALL:4}),Object.freeze({HIRAGANA:0,KATAKANA:1,MIXED:2});let d="https://bryanjimenez.github.io/nmemonica",h=["manifest.webmanifest","147.faf60339.js","911.deeaeb44.js","icon512.png","314.c38c572a.css","main.e71f6f36.css","256.f980d2fd.js","927.c226c6cc.css","314.c38c572a.js","icon192.png","147.faf60339.css","927.c226c6cc.js","341.b54ba44b.js","index.html","174.9e1e43e4.js","favicon.ico","maskable512.png","961.e065cca0.css","961.e065cca0.js","43.01ea800b.js","main.e71f6f36.js"],f=r.pronounceEndpoint,E=r.audioServicePath,S=globalThis.self;S.addEventListener("install",function(e){S.skipWaiting();let t=O();A(i.SW_GET_VERSIONS,t)}),S.addEventListener("activate",function(e){"clients"in S&&S.clients.matchAll({includeUncontrolled:!0}).then(function(e){let t=e.map(function(e){return e.url});console.log("[ServiceWorker] Matching clients:",t.join(", ")),b("Matching clients:"+t.join(", "),u.DEBUG)}),e.waitUntil(Promise.all([caches.keys().then(e=>Promise.all(e.reduce((e,t)=>[R,m,p].includes(t)?e:(console.log("[ServiceWorker] Deleting cache:",t),[...e,caches.delete(t)]),[]))),caches.open(m).then(e=>e.keys().then(t=>Promise.all(t.reduce((t,n)=>{let r=n.url.split("/").pop();return r&&r.indexOf(".")>-1&&!h.includes(r)?(console.log("[ServiceWorker] Removed static asset: "+r),[...t,e.delete(n.url)]):t},[]))))]).then(function(){return console.log("[ServiceWorker] Claiming clients"),b("Claiming clients",u.DEBUG),S.clients.claim()}).then(()=>Promise.all([function(){let e=d+"/";return caches.open(m).then(t=>t.addAll([d,e])).catch(()=>{console.log("[ServiceWorker] / Prefectch failed for some item")})}(),caches.open(m).then(e=>e.addAll([...h])).catch(()=>{console.log("[ServiceWorker] Asset Prefectch failed for some item")})])))}),S.addEventListener("fetch",function(e){var t,n;if("OPTIONS"===e.request.method){e.respondWith(fetch(e.request));return}if("GET"!==e.request.method)return;let r=e.request.clone(),c=e.request.url,i=c.slice(c.indexOf("/",9));switch(!0){case c.includes("githubusercontent")&&r.headers.has(o.DATA_VERSION):{let t=e.request.headers.get(o.DATA_VERSION),n=caches.open(R).then(e=>e.match(c+".v"+t)).then(e=>{if(void 0===e)throw Error(`Missing ${c+".v"+t}`);return e});e.respondWith(n);break}case c.startsWith(d)&&!c.endsWith(".hot-update.json"):e.respondWith((t=c,caches.open(m).then(e=>e.match(t)).then(e=>e||v(m,new Request(t)))));break;case i.startsWith(E):{let t=new URLSearchParams(c.includes("?")?c.split("?")[1]:"").get("uid");if(!t)throw Error("Request missing uid");let o=function(e,t){let[n,r]=e.includes("?")?e.split("?"):[e,""],o=new URLSearchParams(r);return o.delete("uid"),[n,o.toString()].join("?")}(c,0),i=r.url.startsWith(f)?new Request(o):r;"reload"===r.headers.get("Cache-Control")&&e.respondWith(function(e,t){if(console.log("[ServiceWorker] Overriding Asset in Cache"),!S.indexedDB)return console.log(g),b(g,u.WARN),v(p,t);{b("IDB.override",u.WARN);let n=fetch(t);return l({logger:b}).then(t=>n.then(e=>{if(!e.ok)throw b("fetch",u.ERROR),Error("Network response was not OK"+(e.status?" ("+e.status+")":""));return e.blob()}).then(n=>(function(e,t){let{db:n,store:r}=e,o=s.MEDIA,c=n.transaction([r??o],"readwrite"),i=c.objectStore(r??o).put(t);return Promise.all([new Promise((e,t)=>{i.onsuccess=function(){e(void 0)},i.onerror=function(){t()}}),new Promise((e,n)=>{c.oncomplete=function(){e(t)},c.onerror=function(){n()}})]).then(e=>e[1])})({db:t},{uid:e,blob:n}).then(e=>_(e))))}}(t,i)),e.respondWith(S.indexedDB?l({logger:b}).then(e=>(function(e,t){let{db:n,store:r,logger:o}=e,c=s.MEDIA,i=n.transaction([r??c]),l=i.objectStore(r??c).get(t);return Promise.all([new Promise((e,t)=>{l.onerror=function(){"function"==typeof o&&o("IDB.get X(",1),t()},l.onsuccess=function(){l.result?e(l.result):t(Error("No results found",{cause:{code:a.NoResult}}))}}),new Promise((e,t)=>{i.oncomplete=function(){e(void 0)},i.onerror=function(){t()}})]).then(e=>e[0])})({db:e,store:s.MEDIA},t).then(e=>_(e)).catch(()=>(b("IDB.get [] ",u.WARN),fetch(i).then(e=>{if(!e.ok)throw b("fetch",u.ERROR),Error("Network response was not OK"+(e.status?" ("+e.status+")":""));return e.blob()}).then(n=>(function(e,t){let{db:n,store:r}=e,o=s.MEDIA,c=n.transaction([r??o],"readwrite"),i=c.objectStore(r??o).add(t);return Promise.all([new Promise((e,t)=>{i.onsuccess=function(){e(void 0)},i.onerror=function(){t()}}),new Promise((e,n)=>{c.oncomplete=function(){e(t)},c.onerror=function(){n()}})]).then(e=>e[1])})({db:e},{uid:t,blob:n}).then(e=>_(e)))))):(console.log(g),b(g,u.WARN),n=i.url,caches.open(p).then(e=>e.match(n)).then(e=>e||v(p,new Request(n)))));break}default:e.respondWith(fetch(e.request))}}),S.addEventListener("message",function(e){let t=e.data;if(t.type===i.SW_REFRESH_HARD&&t.type===i.SW_REFRESH_HARD){fetch(d+"/robots.txt").then(e=>{if(e.status<400)return caches.delete(m).then(()=>{S.registration.unregister(),A(i.SW_REFRESH_HARD,{msg:"Hard Refresh",status:e.status})});throw Error("Service Unavailable")}).catch(e=>{A(i.SW_REFRESH_HARD,{msg:"Hard Refresh",error:e})});return}if(t.type===i.SW_GET_VERSIONS&&t.type===i.SW_GET_VERSIONS){let e=O();A(i.SW_GET_VERSIONS,e);return}b("Unrecognized message",u.ERROR)});let m="nmemonica-static",R="nmemonica-data",p="nmemonica-media",g="Your browser doesn't support a stable version of IndexedDB.";function O(){return{swVersion:"5358cd17",jsVersion:"e71f6f36",bundleVersion:"235695da"}}function _(e){return new Response(e.blob,{status:200,statusText:"OK"})}function A(e,t){"clients"in S&&S.clients.matchAll({includeUncontrolled:!0,type:"window"}).then(n=>{if(n&&n.length)return n[0].postMessage({type:e,...t})})}function b(e,t){"clients"in S&&S.clients.matchAll({includeUncontrolled:!0,type:"window"}).then(n=>{if(n&&n.length)return n[0].postMessage({type:c.SERVICE_WORKER_LOGGER_MSG,msg:e,lvl:t})}).catch(e=>{console.log("[ServiceWorker] clientLogger failed"),console.log(e)})}function v(e,t){return caches.open(e).then(e=>fetch(t).then(n=>{if(!n.ok)throw Error("Could not fetch");return e.put(t.url,n)}).then(()=>e.match(t.url)).then(e=>{if(!e)throw Error("Could not recache");return e}).catch(()=>(console.log("[ServiceWorker] Network unavailable"),Promise.reject())))}})();